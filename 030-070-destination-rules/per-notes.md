# 030-070-destination-rules

 In this demo, we'll create some different subsets using Destination Rules and forward our traffic to those service endpoints grouped together. Before that, let's have a look at our existing Destination Rules for reviews. We have three different subsets, and they refer to the labels as Version V1, Version V2, and Version V3. Here in the Virtual Services, we simply use these subsets to route our traffic. But what if one day, we somehow needed to group different Deployments together underneath the same service, with a different rule, or label, let's say? To do that, first, we need to add a new label to our app. This new label will help us create some different Destination Rules. Here, I copied the reviews.yml from the samples directory. First, I'll add test-beta-label to the review service. Then, I'll skip my first deployment because I don't want the Version V1 in this new grouping. and add the same label to Version V2 and Version V3 deployments. Now, we'll delete and then apply this YAML. Now, when we go to the Kiali dashboard, our labels can be found in the Workloads page. Here we have test-beta in Version V2 and Version V3, but not in Version V1. So, also in the Applications page, you can see our service has the new label already. Now, let's go to Istio config and create our new subset in the reviews Destination Rule. Let's keep Version V1 subset and add a new test-beta subset. This could help us test two different versions of our app. Like, we can even ask which one they prefer to our customers. When we go to the Virtual Services, because we just removed our old subsets, Kiali is warning us with these yellow lines. Let's only keep V1 and only add our new test-beta subset as a single destination together. Oh, we also need to tell how to manage traffic between those. So, let's open our app to only 10% of total traffic. Obviously, I need to put the name of the subset here, and I got it wrong. Let's go back to our Destination Rule. Yes, it needs to be tested. If we go to our browser, we'll see Reviews V1 most of the time, and V2 and V3 show up, but rarely. We can create some traffic to see how our app is doing. In Istio config, we can go to Reviews and see the traffic distribution. V2 and V3 almost have the same weight, but V1 is almost 9 times their total. Now, let's change this weight distribution altogether, and see how our app is doing. Here, V2 and V3 are taking over the world right now. We then can also create a traffic policy for test subset, and it can be a random load balancer. This way, we can distribute traffic randomly in our subset. As you can see, Reviews V2 and V3 started to change randomly. Now, we can all delete these subsets and try a different traffic policy. It will make all our Review apps work in a round-robin mode. We also need to remove the subsets from our Virtual Services. In the browser, you can follow that the Review service is changing in a round-robin mode. Destination Rules, in conjunction with Virtual Services, help us configure complex traffic management policies.